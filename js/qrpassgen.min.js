var run,getDayOfYear,textOut=null,textIn="",fields={},ctx=null,fldDef={bookRef:{pad:7,desc:"Booking Ref"},from:{pad:3,desc:"From"},to:{pad:3,desc:"To"},fOp:{pad:3,desc:"Flight Operator"},fNum:{pad:5,desc:"Flight Number"},seqNum:{pad:4,desc:"Seq Number"}};function start(){ctx=theimg3.getContext("2d"),formatSeqNum(),formatName(),formatField("bookRef"),formatField("from"),formatField("to"),formatField("fOp"),formatField("fNum"),formatField("seqNum"),formatDay(),formatClass(),formatSeat();const e=new URLSearchParams(window.location.search),t=Object.fromEntries(e.entries());Object.keys(t).length>0&&(Object.entries(t).forEach((([e,t])=>fields[e]=t)),document.getElementById("dateEd").value=getDateFromDays(fields.date)),update()}function update_bookmark(e){let t=Object.entries(e).map((([e,t])=>`${e}=${t}`));document.getElementById("bookmark").href="?"+t.join("&")}function errclear(){errMsg.innerHTML="",errMsg.style.display="hidden"}function err(e){""==errMsg.innerHTML&&(errMsg.innerHTML=e,errMsg.style.display="block")}function verificarTextEdit(){const e=document.getElementById("textEdit"),t=document.getElementById("generateButton"),d=e.textContent.trim();d.includes("M1/")||0===d.length?t.style.display="none":t.style.display="block"}const datosPrecargados={firstName:"CAMELA",lastName:"BENITO",bookingRef:"FAKE2025",date:"2024-03-15",from:"MAD",to:"JFK",fOp:"IBE",fNum:"4567",seatNum:"3A",classSel:"F"},botonPreCarga=document.querySelector(".menu li:first-child a");function update(e){let t=[];t.name=fields.name,t.fOp=fields.fOp,t.fNum=fields.fNum,t.from=fields.from,t.to=fields.to,t.date=fields.date,t.seat=fields.seat,t.bookRef=fields.bookRef,t.seqNum=fields.seqNum,t.cls=fields.cls,Object.values(t).includes("")?document.querySelector(".qrcode").style.opacity="0.3":document.querySelector(".qrcode").style.opacity="1",update_bookmark(t),e?textIn=textEdit.value:textEdit.innerHTML=textIn,verificarTextEdit(),theimg2.onerror=function(e){console.error("Error al cargar SVG:",e)}}function format(){const e={firstNameEd:document.getElementById("firstNameEd"),lastNameEd:document.getElementById("lastNameEd"),fOpEd:document.getElementById("fOpEd"),fNumEd:document.getElementById("fNumEd"),fromEd:document.getElementById("fromEd"),toEd:document.getElementById("toEd"),seatNumEd:document.getElementById("seatNumEd"),bookRefEd:document.getElementById("bookRefEd"),seqNumEd:document.getElementById("seqNumEd"),classSel:document.getElementById("classSel")},t=[],d=[];for(const o in e)e[o]?""===e[o].value.trim()&&d.push(o):t.push(o);if(0===t.length&&0===d.length){if(""===fields.name.trim()||""===fields.bookRef.trim()||""===fields.from.trim()||""===fields.to.trim()||""===fields.fOp.trim()||""===fields.fNum.trim()||""===fields.date.trim()||""===fields.cls.trim()||""===fields.seat.trim()||""===fields.seqNum.trim())return void console.log("Al menos un campo está vacío. No se actualiza ni se muestra error.");document.getElementById("firstNameEd").value=fields.name.trim().split("/")[1].toUpperCase(),document.getElementById("lastNameEd").value=fields.name.trim().split("/")[0].toUpperCase(),document.getElementById("fOpEd").value=fields.fOp.toUpperCase(),document.getElementById("fNumEd").value=fields.fNum.toUpperCase(),document.getElementById("fromEd").value=fields.from.toUpperCase(),document.getElementById("toEd").value=fields.to.toUpperCase(),document.getElementById("seatNumEd").value=fields.seat.toUpperCase(),document.getElementById("bookRefEd").value=fields.bookRef.toUpperCase(),document.getElementById("seqNumEd").value=fields.seqNum.toUpperCase(),"M"==fields.cls&&(fields.cls="Y"),document.getElementById("classSel").value=fields.cls.toUpperCase(),textIn="M1"+upPadRight(fields.name,20)+"E"+upPadRight(fields.bookRef,fldDef.bookRef.pad)+upPadRight(fields.from,fldDef.from.pad)+upPadRight(fields.to,fldDef.to.pad)+upPadRight(fields.fOp,fldDef.fOp.pad)+upPadRight(fields.fNum,fldDef.fNum.pad)+padLeft(fields.date,3)+fields.cls+padLeft(fields.seat,4)+padLeft(fields.seqNum,4)+" 100",update(),document.getElementById("errMsg").style.display="none"}else{let e="";t.length>0&&(e+="Error: No se encontraron los siguientes elementos: "+t.join(", ")+". "),d.length>0&&(e+="Los siguientes campos están vacíos: "+d.join(", ")+"."),console.error(e),err(e)}}function upPadRight(e,t){for(e=e.toUpperCase();e.length<t;)e+=" ";return e.substr(0,t)}function padLeft(e,t){for(e=e.toUpperCase();e.length<t;)e="0"+e;return e.substr(0,t)}function formatField(e,t){errclear("");var d=fldDef[e],o=document.getElementById(e+"Ed").value;o.length>d.pad&&err('"'+d.desc+'" longer than '+d.pad+" chars"),fields[e]=o,t&&format()}function formatName(e){errclear(),lastNameEd.value.length>18&&err("first name longer than 18 charcters");var t=lastNameEd.value+"/"+firstNameEd.value;t.length>20&&err("first+last name longer than 20 characters"),fields.name=t,e&&format()}function formatDay(e){var t=dateEd.value.split("-"),d=parseInt(t[2]),o=parseInt(t[1])-1,a=parseInt(t[0]);dayOfYearEd.value=dayOfYear(a,o,d),fields.date=dayOfYearEd.value,e&&format()}function dayOfYear(e,t,d){var o=new Date(e,t,d,1,0,0)-new Date(e,0,1,0,0);return Math.floor(o/864e5)+1}function getDateFromDays(e){var t=(new Date).getFullYear();return console.log(new Date(t,0,e)),console.log(new Date(t,0,e).toLocaleString("sv").substring(0,10)),new Date(t,0,e).toLocaleString("sv").substring(0,10)}function formatClass(e){fields.cls=classSel.value,e&&format()}function formatSeat(e){errclear();var t=seatNumEd.value;t.length>4&&err("Seat longer than 4 chars"),fields.seat=t,e&&format()}function formatSeqNum(e){errclear();var t="0"+getRandomArbitrary(300,500);t.length>4&&err("Seq number longer than 4 chars"),"0000"==seqNumEd.value?document.getElementById("seqNumEd").value=t:fields.seqNum=seqNumEd.value,e&&format()}function typeUpdate(){"0"==codeTypeSel.value?symSize.value="11":symSize.value="6",update()}function getRandomArbitrary(e,t){return Math.round(Math.random()*(t-e)+e)}function loadQRCode(e){errclear(),0!=e.files.length&&html5QrCode.scanFile(e.files[0],!1).then((t=>{fields.name=t.substring(2,22),fields.bookRef=t.substring(23,29).trim(),fields.from=t.substring(30,33).trim(),fields.to=t.substring(33,36).trim(),fields.fOp=t.substring(36,39).trim(),fields.fNum=t.substring(39,44).trim(),fields.seat=t.substring(49,52).trim(),fields.cls=t.substring(47,48).trim(),fields.date=t.substring(44,47).trim(),fields.seqNum=t.substring(52,56).trim(),document.getElementById("dateEd").value=getDateFromDays(fields.date),e&&format()})).catch((e=>{err("Error scanning file. Crop only to QR-Code part."),console.log(`Error scanning file. Reason: ${e}`)}))}function generateBarcode(){const e=document.getElementById("codeTypeSel").value;let t;"1"===e?t="pdf417":"0"===e?t="azteccode":(console.error("Valor de formato inválido: "+e),t="pdf417");const d=parseInt(document.getElementById("symSize").value),o=document.getElementById("barcode"),a=document.getElementById("errMsg");a.innerHTML="";const r=document.getElementById("textEdit").textContent;console.log("format:",t),console.log("barcodeData:",r),console.log("moduleSize:",d);let n={bcid:t,text:r,scale:d,includetext:!1};"pdf417"===t?n.columns=d:"azteccode"===t&&(n.layers=d);try{bwipjs.toCanvas(o,n),document.getElementById("theimg2").style.display="none",document.getElementById("barcode").style.display="block"}catch(e){a.innerHTML="Error al generar el código. Por favor, verifica los datos ingresados.",console.error(e)}}botonPreCarga.addEventListener("click",(function(e){e.preventDefault(),document.getElementById("firstNameEd").value=datosPrecargados.firstName,document.getElementById("lastNameEd").value=datosPrecargados.lastName,document.getElementById("bookRefEd").value=datosPrecargados.bookingRef,document.getElementById("dateEd").value=datosPrecargados.date,document.getElementById("fromEd").value=datosPrecargados.from,document.getElementById("toEd").value=datosPrecargados.to,document.getElementById("fOpEd").value=datosPrecargados.fOp,document.getElementById("fNumEd").value=datosPrecargados.fNum,document.getElementById("seatNumEd").value=datosPrecargados.seatNum,document.getElementById("classSel").value=datosPrecargados.classSel,formatName(!0),formatField("bookRef",!0),formatDay(!0),formatField("from",!0),formatField("to",!0),formatField("fOp",!0),formatField("fNum",!0),formatSeat(!0),formatClass(!0),update(),typeUpdate()})),window.addEventListener("hashchange",(function(){"#open-modal"!==window.location.hash&&(format(),update())})),window.addEventListener("DOMContentLoaded",verificarTextEdit);const disclaimerContainer=document.getElementById("disclaimer-container"),acceptButton=document.getElementById("accept-button"),wrapper=document.querySelector(".wrapper"),header=document.querySelector("header");window.addEventListener("DOMContentLoaded",(()=>{disclaimerContainer.style.display="flex",wrapper.style.display="none",header.style.display="block",acceptButton.addEventListener("click",(()=>{disclaimerContainer.style.display="none",wrapper.style.display="block"}))}));